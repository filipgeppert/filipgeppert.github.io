
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="/theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark)"
    href="/theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark)"
          href="/theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"
          href="/theme/pygments/monokai.min.css">


  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/solid.css">




    <link rel="shortcut icon" href="theme/img/icon.ico" type="image/x-icon">
    <link rel="icon" href="theme/img/icon.ico" type="image/x-icon">

<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-138257111-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->  


 

<meta name="author" content="Filip Geppert" />
<meta name="description" content="What has changed in Pandas over the last year -&gt; summary of release notes." />
<meta name="keywords" content="Python, Data, Pandas">


  <meta property="og:site_name" content="Filip Geppert - python & data developer"/>
  <meta property="og:title" content="Pandas in 2019 - let&#39;s see what&#39;s new!"/>
  <meta property="og:description" content="What has changed in Pandas over the last year -&gt; summary of release notes."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="/pandas-2019-whats-new.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2019-09-05 00:00:00+02:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="/author/filip-geppert.html">
  <meta property="article:section" content="Data Science"/>
  <meta property="article:tag" content="Python"/>
  <meta property="article:tag" content="Data"/>
  <meta property="article:tag" content="Pandas"/>
  <meta property="og:image" content="/https://s3.amazonaws.com/filipgeppert-blog-materials/img/8.jpg">

  <title>Filip Geppert - python & data developer &ndash; Pandas in 2019 - let&#39;s see what&#39;s new!</title>

</head>
<body >
  <aside>
    <div>
      <a href="/">
        <img src="/theme/img/profile.png" alt="" title="">
      </a>

      <h1>
        <a href="/"></a>
      </h1>

<p>Python & Data developer</p>
<p>Sign up to my newsletter and get a free copy of my Ebook on data science.</p>      <form class="row gap-y" action="https://formspree.io/filip.geppert@gmail.com"
            method="POST">
        <input
                class=""
                type="text"
                name="_replyto"
                placeholder="Your email"
                id="email">
        <button class="btn" type="submit" value="Send">
          Sign up!
        </button>
      </form>


      <nav>
        <ul class="list">



            <li>
              <a target="_self" href="https://www.linkedin.com/in/filip-geppert-62a9bba1/" >cv</a>
            </li>
            <li>
              <a target="_self" href="https://buildondata.com" >Want to hire python specialists?</a>
            </li>
        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-twitter" href="https://twitter.com/filipgepper" target="_blank">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
          <li>
            <a  class="sc-github" href="https://github.com/filipgeppert" target="_blank">
              <i class="fab fa-github"></i>
            </a>
          </li>
          <li>
            <a  class="sc-linkedin" href="https://www.linkedin.com/in/filip-geppert-62a9bba1/" target="_blank">
              <i class="fab fa-linkedin"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="/">Home</a>

      <a href="/index.html">Home</a>
      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>


    </nav>

<article class="single">
  <header>
      
    <h1 id="pandas-2019-whats-new">Pandas in 2019 - let's see what's new!</h1>
    <p>
      Posted on czw 05 września 2019 in <a href="/category/data-science.html">Data Science</a>

    </p>
  </header>


  <div>
    <p>In case you forgot to read release notes for Pandas 0.24 &amp; 0.25 version, then don't worry. 
Below I summarized new functionalities that will make your coding process faster, easier and more effective. All thank's to Pandas
open source community that is constantly improving the package!  </p>
<p>Particularly, we are going to see the following examples:</p>
<ul>
<li><code>Int64</code> type in Pandas</li>
<li>Named aggregations</li>
<li>pandas <code>.explode</code> method</li>
<li>JSON normalization</li>
<li>how <code>.rename</code> can raise <code>KeyError</code></li>
<li>Using your favourite plotting backend directly in Pandas</li>
</ul>
<hr>
<h2>How <code>int</code> can live with <code>None</code></h2>
<div class="highlight"><pre><span></span><code>:::python
cities = pd.DataFrame({&#39;continent&#39;: [&#39;Europe&#39;, &#39;Europe&#39;, &#39;Europe&#39;, &#39;North America&#39;, &#39;North America&#39;],
                       &#39;cities&#39;: [&#39;barcelona&#39;, &#39;warsaw&#39;, &#39;paris&#39;, &#39;montreal&#39;, &#39;toronto&#39;],
                       &#39;residents&#39;: [1620000, 1777000, 2140000, None, 2731000],
                       &#39;area&#39;: [101, 517, 105 , None, 630]
                      })
cities
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nb">+---+---------------+-----------+-----------+-------+</span><span class="c"></span>
<span class="c">|   |   continent   |  cities   | residents | area  |</span>
<span class="nb">+---+---------------+-----------+-----------+-------+</span><span class="c"></span>
<span class="c">| 0 | Europe        | barcelona | 1620000</span><span class="nt">.</span><span class="c">0 | 101</span><span class="nt">.</span><span class="c">0 |</span>
<span class="c">| 1 | Europe        | warsaw    | 1777000</span><span class="nt">.</span><span class="c">0 | 517</span><span class="nt">.</span><span class="c">0 |</span>
<span class="c">| 2 | Europe        | paris     | 2140000</span><span class="nt">.</span><span class="c">0 | 105</span><span class="nt">.</span><span class="c">0 |</span>
<span class="c">| 3 | North America | montreal  | NaN       | NaN   |</span>
<span class="c">| 4 | North America | toronto   | 2731000</span><span class="nt">.</span><span class="c">0 | 630</span><span class="nt">.</span><span class="c">0 |</span>
<span class="nb">+---+---------------+-----------+-----------+-------+</span><span class="c"></span>
</code></pre></div>

<p>As we can see, residents and area columns are float type even though we passed <code>int</code> types as input.
That's because fourth row contains <code>NaNs</code>. Luckily, now we can change it with the use of <code>Int64</code> data type.</p>
<div class="highlight"><pre><span></span><code>:::python
cities[[&#39;residents&#39;, &#39;area&#39;]] = cities[[&#39;residents&#39;, &#39;area&#39;]].astype(&#39;Int64&#39;)
cities
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nb">+---+---------------+-----------+-----------+------+</span><span class="c"></span>
<span class="c">|   |   continent   |  cities   | residents | area |</span>
<span class="nb">+---+---------------+-----------+-----------+------+</span><span class="c"></span>
<span class="c">| 0 | Europe        | barcelona | 1620000   | 101  |</span>
<span class="c">| 1 | Europe        | warsaw    | 1777000   | 517  |</span>
<span class="c">| 2 | Europe        | paris     | 2140000   | 105  |</span>
<span class="c">| 3 | North America | montreal  | NaN       | NaN  |</span>
<span class="c">| 4 | North America | toronto   | 2731000   | 630  |</span>
<span class="nb">+---+---------------+-----------+-----------+------+</span><span class="c"></span>
</code></pre></div>

<p>Works like a charm!</p>
<hr>
<h2>Named aggregations</h2>
<p>Named aggregations is what will make your groupby/rename process much faster. Now you can do it in one line:</p>
<p>This is how you can use it on DataFrame:</p>
<div class="highlight"><pre><span></span><code><span class="o">:::</span><span class="n">python</span>
<span class="p">#</span> <span class="n">Named</span> <span class="n">aggregations</span> <span class="n">on</span> <span class="n">DataFrame</span>
<span class="n">cities</span><span class="p">.</span><span class="n">groupby</span><span class="p">(&#39;</span><span class="n">continent</span><span class="p">&#39;).</span><span class="n">agg</span><span class="p">(</span>
    <span class="n">avg_habitants</span> <span class="o">=</span> <span class="p">(&#39;</span><span class="n">residents</span><span class="p">&#39;,</span> <span class="p">&#39;</span><span class="n">mean</span><span class="p">&#39;),</span>
    <span class="n">max_area</span> <span class="o">=</span> <span class="p">(&#39;</span><span class="n">area</span><span class="p">&#39;,</span> <span class="p">&#39;</span><span class="n">max</span><span class="p">&#39;)</span>
<span class="p">)</span>
</code></pre></div>

<p>Result:</p>
<div class="highlight"><pre><span></span><code><span class="nb">+---------------+---------------+----------+</span><span class="c"></span>
<span class="c">|               | avg_habitants | max_area |</span>
<span class="nb">+---------------+---------------+----------+</span><span class="c"></span>
<span class="c">| continent     |               |          |</span>
<span class="c">| Europe        | 1</span><span class="nt">.</span><span class="c">845667e</span><span class="nb">+</span><span class="c">06  |      517 |</span>
<span class="c">| North America | 2</span><span class="nt">.</span><span class="c">731000e</span><span class="nb">+</span><span class="c">06  |      630 |</span>
<span class="nb">+---------------+---------------+----------+</span><span class="c"></span>
</code></pre></div>

<p>And on series:</p>
<div class="highlight"><pre><span></span><code>:::python
# On Series
cities.groupby(&#39;continent&#39;).area.agg(
    max_area=&#39;max&#39;,
    min_area=np.min,
)
</code></pre></div>

<p>Result:</p>
<div class="highlight"><pre><span></span><code><span class="nb">+---------------+----------+----------+</span><span class="c"></span>
<span class="c">|               | max_area | min_area |</span>
<span class="nb">+---------------+----------+----------+</span><span class="c"></span>
<span class="c">| continent     |          |          |</span>
<span class="c">| Europe        |      517 |      101 |</span>
<span class="c">| North America |      630 |      630 |</span>
<span class="nb">+---------------+----------+----------+</span><span class="c"></span>
</code></pre></div>

<hr>
<h2><code>list</code> to multiple columns</h2>
<p>Personally, I don't like storing list in DataFrame cells, but let's be honest -&gt; It sometimes happens.
Now we can use <code>.explode</code> to handle their transformation:</p>
<div class="highlight"><pre><span></span><code>:::python
# Data column contains a list of two values
barcelona = pd.DataFrame({&#39;city&#39;: [&#39;Barcelona&#39;],
                       &#39;data&#39;: [[1620000,101]]})
barcelona
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nb">+---+-----------+----------------+</span><span class="c"></span>
<span class="c">|   |   city    |      data      |</span>
<span class="nb">+---+-----------+----------------+</span><span class="c"></span>
<span class="c">| 0 | Barcelona | </span><span class="k">[</span><span class="c">1620000</span><span class="nt">,</span><span class="c"> 101</span><span class="k">]</span><span class="c"> |</span>
<span class="nb">+---+-----------+----------------+</span><span class="c"></span>
</code></pre></div>

<p>Here is how you can transform <code>data</code> column to long format and get rid of list:</p>
<div class="highlight"><pre><span></span><code>:::python
barcelona.explode(&#39;data&#39;)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nb">+---+-----------+---------+</span><span class="c"></span>
<span class="c">|   |   city    |  data   |</span>
<span class="nb">+---+-----------+---------+</span><span class="c"></span>
<span class="c">| 0 | Barcelona | 1620000 |</span>
<span class="c">| 0 | Barcelona |     101 |</span>
<span class="nb">+---+-----------+---------+</span><span class="c"></span>
</code></pre></div>

<p>I bet that this is going to help you a lot!</p>
<hr>
<h2>JSON as columns</h2>
<p>We use JSON a lot, it has it's pros and cons, but so far there was no sufficient option in Pandas to read
nested JSON file such us the following:</p>
<div class="highlight"><pre><span></span><code>:::python
data = [{
    &#39;City&#39;: {&#39;name&#39;: &#39;Barcelona&#39;,
             &#39;area&#39;: 101,
             &#39;residents&#39;: {&#39;2018&#39;: 1600000, &#39;2019&#39;: 1620000}},
    &#39;Country&#39;: {&#39;name&#39;: &#39;Spain&#39;,
                &#39;continent&#39;: &#39;Europe&#39;}
}]
</code></pre></div>

<p>See that <code>residents</code> attribute is a descendant of <code>City</code> attribute.
But here comes Pandas with its new <code>json_normalize</code> method!</p>
<div class="highlight"><pre><span></span><code><span class="p">:::</span><span class="n">python</span>
<span class="kn">from</span> <span class="nn">pandas.io.json</span> <span class="kn">import</span> <span class="n">json_normalize</span>
<span class="n">json_normalize</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">max_level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nb">+---+-----------+-----------+---------------------+---------------------+--------------+-------------------+</span><span class="c"></span>
<span class="c">|   | City</span><span class="nt">.</span><span class="c">name | City</span><span class="nt">.</span><span class="c">area | City</span><span class="nt">.</span><span class="c">residents</span><span class="nt">.</span><span class="c">2018 | City</span><span class="nt">.</span><span class="c">residents</span><span class="nt">.</span><span class="c">2019 | Country</span><span class="nt">.</span><span class="c">name | Country</span><span class="nt">.</span><span class="c">continent |</span>
<span class="nb">+---+-----------+-----------+---------------------+---------------------+--------------+-------------------+</span><span class="c"></span>
<span class="c">| 0 | Barcelona |       101 |             1600000 |             1620000 | Spain        | Europe            |</span>
<span class="nb">+---+-----------+-----------+---------------------+---------------------+--------------+-------------------+</span><span class="c"></span>
</code></pre></div>

<p>Take a note that <code>max_level</code> parameter describes how many levels of depth we would like to transform to columns.</p>
<hr>
<h2><code>.rename</code> raises errors</h2>
<p>Earlier, all errors were silent. Now this happens if we want to rename column that does not exist and you set
appropriate flag:</p>
<div class="highlight"><pre><span></span><code>:::python
cities.rename({&#39;does_not_exist&#39;: &#39;will_raise_an_error&#39;}, errors=&#39;raise&#39;)
</code></pre></div>

<div class="highlight"><pre><span></span><code>:::python
KeyError: &quot;[&#39;does_not_exist&#39;] not found in axis&quot;
</code></pre></div>

<hr>
<h2>Various plotting backends</h2>
<p>This is something that I personally have been waiting for a long time. Pandas now allows to use different plotting backends straight from their API.
To do so, you need to first find your favourite plotting package. Important: this package has to be adjusted to Pandas. So far, I tested
two plotting packages:
- Pandas_Bokeh -&gt; <a href="https://github.com/PatrikHlobil/Pandas-Bokeh">Source code and docs</a>
- Plotly -&gt; unfortunately, I haven't found their Pandas implementation:(</p>
<p>To use is as a plotting backend (and say goodbye to Matplotlib...), we need to set the following option:</p>
<div class="highlight"><pre><span></span><code><span class="p">:::</span><span class="n">python</span>
<span class="kn">import</span> <span class="nn">pandas_bokeh</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;plotting.backend&#39;</span><span class="p">,</span> <span class="s1">&#39;pandas_bokeh&#39;</span><span class="p">)</span>
</code></pre></div>

<p>Now you can use it to create your favourite plots:</p>
<div class="highlight"><pre><span></span><code>:::python
cities.plot_bokeh.scatter(
    x=&quot;residents&quot;,
    y=&quot;area&quot;,
    category=&quot;cities&quot;,
    title=&quot;Cities information&quot;,
    show_figure=True
)
</code></pre></div>

<p>Voilà!</p>
<hr>
<h2>Summary</h2>
<p>If you want to read the whole release notes, you can find it <a href="https://pandas.pydata.org/pandas-docs/stable/whatsnew/v0.25.0.html">here</a>.
And remember that you can also contribute to open source by either donating some money or pushing your commits.
Just go to Pandas (or any other open source package) repo, find your first issue and create your first pull request!:)</p>
<p>Happy coding!</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="/tag/python.html">Python</a>
      <a href="/tag/data.html">Data</a>
      <a href="/tag/pandas.html">Pandas</a>
    </p>
  </div>

  <div class="center social-share">
    <p>Like this article? Share it with your friends!</p>
    <div class="addthis_native_toolbox"></div>
    <div class="addthis_sharing_toolbox"></div>
    <div class="addthis_inline_share_toolbox"></div>
  </div>

  <div class="neighbors">
    <a class="btn float-left" href="/open-cv-basics-guide.html" title="Pythonic intro to OpenCV.">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
    <a class="btn float-right" href="/pydata-warsaw-talk.html" title="How to prepare your first content-based talk">
      Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>

    <div class="addthis_relatedposts_inline"></div>


<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'filipgeppert-com';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>

    <footer>
<p>&copy; 2022 </p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="/theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p>    </footer>
  </main>


    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5cb1aa9b85683c98" async="async"></script>


<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Filip Geppert - python & data developer ",
  "url" : "",
  "image": "",
  "description": "My thoughts and tutorials on programming and data engineering. I write about data and web development, machine learning and engineering best practices."
}
</script>

</body>
</html>